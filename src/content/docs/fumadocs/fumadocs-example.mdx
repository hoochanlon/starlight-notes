---
title: Fumadocs 简要配置
---

## 前言

在 docusaurus 不能完全支持 shiki 之前，我是不会用它的。版面布局跟 vuepress 很像。而 fumadocs 又和上古的 gitbook 挺像，所以还是决定用它。

## 踩坑！不能插入图片的解决办法


```mjs title="next.config.mjs" ins={9-18}
import { createMDX } from 'fumadocs-mdx/next';

const withMDX = createMDX();

/** @type {import('next').NextConfig} */
const config = {
  reactStrictMode: true,

  images: {
    // 正确写法（Next.js 15 最新要求）
    remotePatterns: [
      // 放开所有 https 图片（开发/文档站最方便）
      {
        protocol: 'https',
        hostname: '**',
      },
    ],
  },
};

export default withMDX(config);
```

![](https://images.sonurai.com/SaltDesert.jpg)


## React Hydration Error（水合不匹配错误）

浏览器广告屏蔽/翻译/暗黑模式等扩展在 React hydrate 之前偷偷修改了服务端渲染的 HTML，导致客户端看到的 DOM 和 React 预期的不一致，触发水合错误。

## 找到不错的例子，减少折腾

官方给的教程过于抽象，很多坑都要踩了才懂。而有一个现成调试好的例子就显得尤为必要了。

sh2aliyev/notes：https://github.com/sh2aliyev/notes


## 站点标题

\lib\layout.shared.tsx

```tsx
import { BookIcon } from 'lucide-react';
import type { BaseLayoutProps } from 'fumadocs-ui/layouts/shared';

export function baseOptions(): BaseLayoutProps {
  return {
    nav: {
      title: 'Fumadocs Notes',
    },
  };
}
```

\app\og\docs\[...slug]\route.tsx 搜索 `site=`，更改


## 首页界面相关

https://github.com/fuma-nama/fumadocs/issues/2720

## 数学公式支持

运行

```bash
pnpm install remark-math rehype-katex katex
```

如果根目录没有 source.config.ts 文件，直接创建，并复制如下代码

```ts title="source.config.ts"
import rehypeKatex from 'rehype-katex';
import remarkMath from 'remark-math';

import {
  defineConfig,
  defineDocs,
  frontmatterSchema,
  metaSchema,
} from 'fumadocs-mdx/config';

// You can customise Zod schemas for frontmatter and `meta.json` here
// see https://fumadocs.dev/docs/mdx/collections
export const docs = defineDocs({
  dir: 'content/docs',
  docs: {
    schema: frontmatterSchema,
    postprocess: {
      includeProcessedMarkdown: true,
    },
  },
  meta: {
    schema: metaSchema,
  },
});

export default defineConfig({
  mdxOptions: {
    // MDX options
    remarkPlugins: [remarkMath],
    // Place it at first, it should be executed before the syntax highlighter
    rehypePlugins: (v) => [rehypeKatex, ...v],    
  },
});
```
在 ./app/layout.tsx 导入

```tsx title="./app/layout.tsx"
import 'katex/dist/katex.css';
```

## Mermaid 支持

运行 `npm install mermaid next-themes` 创建文件 components/mdx/mermaid.tsx 并写入

```tsx title="components/mdx/mermaid.tsx"
'use client';

import { use, useEffect, useId, useState } from 'react';
import { useTheme } from 'next-themes';

export function Mermaid({ chart }: { chart: string }) {
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) return;
  return <MermaidContent chart={chart} />;
}

const cache = new Map<string, Promise<unknown>>();

function cachePromise<T>(
  key: string,
  setPromise: () => Promise<T>,
): Promise<T> {
  const cached = cache.get(key);
  if (cached) return cached as Promise<T>;

  const promise = setPromise();
  cache.set(key, promise);
  return promise;
}

function MermaidContent({ chart }: { chart: string }) {
  const id = useId();
  const { resolvedTheme } = useTheme();
  const { default: mermaid } = use(
    cachePromise('mermaid', () => import('mermaid')),
  );

  mermaid.initialize({
    startOnLoad: false,
    securityLevel: 'loose',
    fontFamily: 'inherit',
    themeCSS: 'margin: 1.5rem auto 0;',
    theme: resolvedTheme === 'dark' ? 'dark' : 'default',
  });

  const { svg, bindFunctions } = use(
    cachePromise(`${chart}-${resolvedTheme}`, () => {
      return mermaid.render(id, chart.replaceAll('\\n', '\n'));
    }),
  );

  return (
    <div
      ref={(container) => {
        if (container) bindFunctions?.(container);
      }}
      dangerouslySetInnerHTML={{ __html: svg }}
    />
  );
}
```


在根目录创建如下文件，并写入代码

```tsx title="./mdx-components.tsx"
import defaultMdxComponents from 'fumadocs-ui/mdx';
import type { MDXComponents } from 'mdx/types';
import { Mermaid } from '@/components/mdx/mermaid';

export function getMDXComponents(components?: MDXComponents): MDXComponents {
  return {
    ...defaultMdxComponents,
    Mermaid,
    ...components,
  };
}
```

## 代码块

###  Shiki Twoslash

这是 Shiki Twoslash 的语法标记，主要用于技术文档中的代码展示。

```
## 常用语法速查

### 差异显示
- `// [!code ++]`      - 添加行（绿色）
- `// [!code --]`      - 删除行（红色）
- `// [!code ++:3]`    - 添加3行
- `// [!code --:2]`    - 删除2行

### 高亮和聚焦
- `// [!code focus]`   - 聚焦此行
- `// [!code highlight]` - 黄色高亮
- `// [!code hl:5-10]` - 高亮5-10行

### 注释提示
- `// [!code tip]`     - 提示信息
- `// [!code warning]` - 警告信息
- `// [!code error]`   - 错误信息
- `// [!code success]` - 成功信息

### 其他
- `// [!code range:1-5]` - 只显示1-5行
- `// [!code skip]`      - 跳过此行
- `tab="filename"`      - 标签页标题
```

```js
// 原始代码
function add(a, b) {
  return a + b;
}

// 添加新功能
function add(a, b) {
  console.log('计算加法'); // [!code ++]
  return a + b;
}

// 删除旧代码
function oldMethod() { // [!code --]
  // 已废弃 // [!code --]
} // [!code --]

// 高亮重要部分
function calculateTotal(items) {
  let total = 0;
  for (let item of items) {
    total += item.price; // [!code highlight]
  }
  return total; // [!code focus]
}
```

### Prism/Rehype 风格


* title="filename.js" - 文件标题
* showLineNumbers - 显示行号
* ins={1,3-5} - 高亮行（插入/新增）
* del={2,4} - 删除行标记
* mark={2,5-7} - 标记高亮行
* collapse={12-80} - 折叠


'```js title="filename.js" showLineNumbers'

### 代码块样式增强

添加行号支持，增大代码字体。

```css title="\app\global.css"  collapse={12-80}
@import 'tailwindcss';
@import 'fumadocs-ui/css/ocean.css';
@import 'fumadocs-ui/css/preset.css';


/* 增强版行号样式 */
.shiki:has(.line:nth-child(3)) {
  counter-reset: line;
  font-size: 1.2rem;
}

/* 行号背景仅作用于代码区域，不影响标题 */
/* 使用与代码块背景相同的变量颜色 */
.shiki:has(.line:nth-child(3)) pre {
  background: linear-gradient(90deg,
    hsl(var(--muted) / 0.3) 0,
    hsl(var(--muted) / 0.3) 3rem,  /* 缩小到 3rem */
    transparent 3rem
  );
  margin: 0;
  position: relative;
}

/* 添加行号与代码之间的实线分隔 */
/* 浅色主题：使用深灰色，与背景色明显区分 */
.shiki:has(.line:nth-child(3)) pre::after {
  content: '';
  position: absolute;
  left: 3rem;  /* 调整到 3rem */
  top: 0;
  bottom: 0;
  width: 1px;
  background: #d1d5db;  /* 浅色主题下的深灰色，明显可见 */
  z-index: 1;
}

/* 深色主题：使用浅灰色，与背景色明显区分 */
.dark .shiki:has(.line:nth-child(3)) pre::after {
  background: #6b7280;  /* 深色主题下的浅灰色，明显可见 */
}

.shiki:has(.line:nth-child(3)) .line {
  /* 行号在分隔线左侧，代码在分隔线右侧 */
  padding-left: 3.1rem;  /* 调整到 3.1rem，稍微缩小 */
  position: relative;
  /* 关键修复：使用正确的行高和高度计算 */
  line-height: 1.6em; /* 使用 em 单位，与字体大小保持一致 */
  min-height: 1.6em;  /* 确保最小高度与行高一致 */
  font-size: 1.2rem;
}

.shiki:has(.line:nth-child(3)) .line::before {
  counter-increment: line;
  content: counter(line);
  position: absolute;
  /* 行号位置：在分隔线（3rem）的左侧，右对齐 */
  left: 0.5rem;  /* 稍微缩小左边距 */
  width: 2.0rem;  /* 稍微缩小宽度 */
  text-align: right;
  padding-right: 0.1rem;  /* 在分隔线左侧留出小间距 */
  color: #6b7280;
  font-size: 1.1rem;
  opacity: 0.9;
  font-family: ui-monospace, 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace;
  font-weight: 400;

  /* 关键修复：使用相同的行高和垂直居中 */
  line-height: 1.6em;  /* 与 .line 保持一致 */
  height: 1.6em;      /* 设置明确的高度 */
  top: 50%;           /* 使用 top 和 transform 实现精确居中 */
  transform: translateY(-50%);
  box-sizing: border-box;
}

/* 代码块整体字体大小调整 */
.shiki {
  font-size: 1.2rem;
  line-height: 1.6;
}

/* 对于1-2行的代码块，保持简洁 */
.shiki:not(:has(.line:nth-child(3))) {
  padding: 1rem 1.2rem;
  border-radius: 0.375rem;
  background: transparent !important;
  font-size: 1.2rem;
}

/* 代码内容的直接样式覆盖 */
.shiki .line,
.shiki code,
.shiki span {
  font-size: 1.2rem !important;
  font-family: ui-monospace, 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace !important;
}

/* 行内代码字号提升（非代码块） */
:not(pre) > code {
  font-size: 1rem;
  font-family: ui-monospace, 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace;
}

/* 深色主题优化 - 使用相同的变量颜色 */
.dark .shiki:has(.line:nth-child(3)) pre {
  background: linear-gradient(90deg,
    hsl(var(--muted) / 0.3) 0,
    hsl(var(--muted) / 0.3) 3rem,  /* 缩小到 3rem */
    transparent 3rem
  );
}

.dark .shiki:has(.line:nth-child(3)) .line::before {
  color: #9ca3af;
}
```


## 笔记本样式


安装 `npx @fumadocs/cli@latest customise`


在 \app\docs\layout.tsx 写入，样式二选一

1

```tsx title="\app\docs\layout.tsx" del={2} ins={3}
import { source } from '@/lib/source';
import { DocsLayout } from 'fumadocs-ui/layouts/docs';
import { DocsLayout } from 'fumadocs-ui/layouts/notebook';
import { baseOptions } from '@/lib/layout.shared';

export default function Layout({ children }: LayoutProps<'/docs'>) {
  return (
    <DocsLayout tree={source.pageTree} {...baseOptions()}>
      {children}
    </DocsLayout>
  );
}
```

2


```tsx title="\app\docs\layout.tsx"
import { DocsLayout } from 'fumadocs-ui/layouts/notebook';
import { baseOptions } from '@/lib/layout.shared';
import { source } from '@/lib/source';
import type { ReactNode } from 'react';

export default function Layout({ children }: { children: ReactNode }) {
  const { nav, ...base } = baseOptions();

  return (
    <DocsLayout
      {...base}
      nav={{ ...nav, mode: 'top' }}
      tree={source.pageTree}
    >
      {children}
    </DocsLayout>
  );
}
```



在 \app\docs\[[...slug]]\page.tsx 修改


```tsx title="\app\docs\[[...slug]]\page.tsx" {7}
import { getPageImage, source } from '@/lib/source';
import {
  DocsBody,
  DocsDescription,
  DocsPage,
  DocsTitle,
} from 'fumadocs-ui/layouts/notebook/page';
```



## 布局链接

创建 github 图标链接

https://fumadocs-zh.zdoc.app/docs/ui/navigation/links


```tsx title="lib\layout.shared.tsx"
import type { BaseLayoutProps } from 'fumadocs-ui/layouts/shared';

export function baseOptions(): BaseLayoutProps {
  return {
    githubUrl: 'https://github.com/hoochanlon',
  };
}
```


## 主题设置


```css title="\app\global.css"
@import 'tailwindcss';
@import 'fumadocs-ui/css/ocean.css';
@import 'fumadocs-ui/css/preset.css';
```

npm 安装

`npm list fumadocs-ui tailwindcss`

测试，检查 ocean.css 是否存在 `Test-Path "node_modules\fumadocs-ui\css\ocean.css"`

清除缓存 `if (Test-Path ".next") { Remove-Item -Recurse -Force ".next" }`

重新运行 `npm run dev`


夜间模式才能看出来

![](https://cdn.jsdelivr.net/gh/hoochanlon/picx-images-hosting@master/uploads/2025/PixPin_2025-12-05_11-01-40.webp)
