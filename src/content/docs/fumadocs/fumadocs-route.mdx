---
title: Fumadocs 目录路由配置
---

## 目录


[提示]：对于习惯了用一个配置文件控制所有目录路由，以及可以根据 slug 来定位永久路由的管理方式，fumadocs 的路由逻辑简直抽象。需要不断摸索。docs->notes路由迁移、Github Pages、slug内容板块由AI生成。

在 Fumadocs 中，当缺少 meta.json 文件时，系统会默认按照文件名的字母顺序来确定页面的展示顺序。你可以通过在文件名前添加数字或字母前缀（例如 01-xxx.mdx、a-intro.mdx）来手动控制排序。此外，在任意文件夹中创建 index.mdx 文件，即可直接将该文件夹作为内容板块来展示。

```
{
  "pages": [
    "文件1",
    "文件2",
    "文件夹3"
  
  ],
  "defaultOpen": true
}
```

示例

![ ](https://tu.zbhz.org/i/2025/12/06/ne4btm.png)


### 示例

\docs\demo-1\meta.json

```json
{
  "title": "栏目-1",
  "icon": "Rainbow",
  "root": true,
  "pages": [
    "---demo-1---",
    "index",
    "test"
  ]
}
```

在 \node_modules\lucide-react\dist\lucide-react.d.ts 搜索如：`const Rainbow` 找到相关图标。

## 主页面

\app\(home)\page.tsx

[`./docs` 默认界面如何实现类似的文档门户页面，用于展示不同模块的文档入口？](https://github.com/fuma-nama/fumadocs/issues/2720)

> you can create a page at `/docs` like `/(home)/docs/page.tsx`, and make the docs catch-all route non-optional.

## Docs 到 Notes 迁移文档

本文档详细记录了将 Fumadocs 项目中的文档路由从 `/docs` 迁移到 `/notes` 的完整过程。

### 迁移概述

本次迁移的目标是将所有与文档相关的路由、配置和内容路径从 `docs` 统一更改为 `notes`，使应用程序的路由结构更加清晰和符合项目定位。

#### 主要变更点

1. **核心配置文件**：更新 `lib/source.ts` 中的内容集合引用和路由配置
2. **路由结构**：验证并确保 `app/notes` 目录包含正确的路由配置
3. **OG 图片生成**：更新图片生成路径以保持一致性
4. **内容路径**：确保所有笔记内容都通过 `/notes` 路由访问

### 详细迁移步骤

#### 步骤 1：检查现有项目结构

在开始迁移前，先了解项目的基本结构：

```bash
# 查看主要目录结构
ls -la app/
```

确保项目中已经存在 `app/notes` 目录，且包含正确的路由配置文件。

#### 步骤 2：更新核心配置文件

修改 `lib/source.ts` 文件，将所有 `docs` 引用替换为 `notes`：

```typescript
// 原代码
import { docs } from 'fumadocs-mdx:collections/server';

// 修改后
import { notes } from 'fumadocs-mdx:collections/server';

// 原代码
export const source = loader({
  baseUrl: '/docs',
  source: docs.toFumadocsSource(),
  plugins: [lucideIconsPlugin()],
});

// 修改后
export const source = loader({
  baseUrl: '/notes',
  source: notes.toFumadocsSource(),
  plugins: [lucideIconsPlugin()],
});

// 更新 OG 图片路径
// 原代码
url: `/og/docs/${segments.join('/')}`,

// 修改后
url: `/og/notes/${segments.join('/')}`,
```

#### 步骤 3：验证路由配置

确保 `app/notes` 目录包含正确的路由配置文件：

```bash
# 检查 notes 路由配置
ls -la app/notes/
```

应该看到以下文件结构：
```
app/notes/
├── [[...slug]]/
│   └── page.tsx
└── layout.tsx
```

#### 步骤 4：移除旧的 docs 路由配置

如果项目中仍然存在 `app/docs` 目录，需要将其移除：

```bash
# 删除旧的 docs 路由目录
rm -rf app/docs
```

#### 步骤 5：更新 OG 图片生成路径

检查并更新 `app/og` 目录下的配置：

1. 确保 `app/og/notes` 目录存在且配置正确
2. 移除不再需要的 `app/og/docs` 目录：

```bash
# 删除旧的 docs OG 配置目录
rm -rf app/og/docs
```

#### 步骤 6：检查首页链接

确保首页上的导航链接指向正确的路径：

```typescript
// 原代码
<Link href="/docs/essay">浏览文档</Link>

// 修改后
<Link href="/notes/essay">浏览笔记</Link>
```

#### 步骤 7：验证内容路径

确保所有笔记内容都存储在 `content/notes` 目录下：

```bash
# 检查内容目录结构
ls -la content/
```

应该看到以下结构：
```
content/
└── notes/
    ├── astro/
    ├── essay/
    └── meta.json
```

#### 步骤 8：运行应用程序验证

启动开发服务器，验证迁移是否成功：

```bash
# 启动开发服务器
pnpm dev
```

检查以下内容：
1. 应用程序是否正常启动，无编译错误
2. 首页链接是否指向 `/notes/essay`
3. 笔记内容是否可以通过 `/notes` 路由正常访问
4. OG 图片是否正确生成

### 配置验证

完成迁移后，需要验证以下配置项：

#### 1. 内容集合引用

确保 `lib/source.ts` 中正确导入了 `notes` 集合：

```typescript
import { notes } from 'fumadocs-mdx:collections/server';
```

#### 2. 路由配置

确保 `app/notes/[[...slug]]/page.tsx` 文件包含正确的路由处理逻辑：

```typescript
import { source } from '@/lib/source';
import { DocsPage } from 'fumadocs-ui/page';

export default function Page({ params }: { params: { slug?: string[] } }) {
  return <DocsPage params={params} source={source} />;
}

// generateStaticParams 和 generateMetadata 函数
```

#### 3. OG 图片生成

确保 `app/og/notes/[...slug]/route.tsx` 文件正确配置：

```typescript
import { getPageImage } from '@/lib/source';
import { source } from '@/lib/source';
import { DefaultImage } from 'fumadocs-ui/og';

// GET 函数和 generateStaticParams 函数
```

### 部署注意事项

#### GitHub Pages 路径配置

如果项目部署在 GitHub Pages 上，需要注意路径配置的一致性：

1. 确保 `next.config.mjs` 中的 `basePath` 配置正确
2. 确保 `lib/source.ts` 中的 `baseUrl` 与 `basePath` 配合使用，避免路径重复

详细配置说明请参考 `GITHUB_PAGES_CONFIG.md` 文件。

#### 内容链接更新

如果笔记内容中包含内部链接，请确保这些链接也从 `/docs` 更新为 `/notes`。

### 故障排除

#### 404 错误

如果访问 `/notes` 路由时出现 404 错误：

1. 检查 `app/notes` 目录是否存在且配置正确
2. 验证 `lib/source.ts` 中的 `baseUrl` 是否设置为 `/notes`
3. 确保 `content/notes` 目录包含笔记内容

#### 编译错误

如果在启动开发服务器时遇到编译错误：

1. 检查是否有遗漏的 `docs` 引用没有替换为 `notes`
2. 验证所有导入路径是否正确
3. 检查是否有文件或目录名称拼写错误

### 总结

完成以上步骤后，项目中的所有文档内容都应该可以通过 `/notes` 路由正常访问，而不是之前的 `/docs` 路由。迁移过程保持了应用程序的功能不变，但路由结构更加清晰和符合项目定位。





## GitHub Pages 路径配置

### 当前配置分析

目前项目的路由配置如下：

1. **Next.js 基础路径 (`next.config.mjs`)**：
   ```javascript
   const basePath = process.env.NODE_ENV === 'production' ? '/fumadocs-notes' : '';
   ```
   - 这是项目在 GitHub Pages 上的根路径
   - 生产环境下，所有路由都会自动添加 `/fumadocs-notes` 前缀

2. **Fumadocs 内容路径 (`lib/source.ts`)**：
   ```javascript
   export const source = loader({
     baseUrl: '/notes',
     // ...
   });
   ```
   - 这是笔记内容的基础路径
   - 所有笔记都会在 `/notes` 路径下访问

### 路径问题说明

如果您将 GitHub 仓库命名为 `notes`，那么：
- GitHub Pages 会使用 `/notes` 作为网站的根路径
- 结合 Fumadocs 的 `/notes` 基础路径
- 最终访问路径会变成：`hoochonlon.github.io/notes/notes/xxxx`

确实会出现重复的 `notes` 路径，这不是我们想要的。

### 解决方案

根据您的 GitHub 仓库名称，有两种解决方案：

#### 方案一：保持仓库名为 `fumadocs-notes`
- 访问路径：`hoochonlon.github.io/fumadocs-notes/notes/xxxx`
- 不需要修改任何配置

#### 方案二：将仓库重命名为 `notes`
如果您希望仓库名为 `notes`，需要修改配置：

1. 更新 `next.config.mjs` 中的基础路径：
   ```javascript
   const basePath = process.env.NODE_ENV === 'production' ? '/notes' : '';
   ```

2. 更新 `lib/source.ts` 中的内容路径：
   ```javascript
   export const source = loader({
     baseUrl: '/',  // 将 '/notes' 改为 '/'，避免重复
     // ...
   });
   ```

   同时更新 OG 图片路径：
   ```javascript
   url: `/og/${segments.join('/')}`,  // 移除 '/notes' 前缀
   ```

3. 更新首页链接 (`app/(home)/page.tsx`)：
   ```javascript
   href="/essay"  // 将 '/notes/essay' 改为 '/essay'
   ```

这样修改后，访问路径会变成：`hoochonlon.github.io/notes/xxxx`（没有重复的 `notes`）

### 部署前检查

在部署到 GitHub Pages 之前，请确保：

1. 仓库名称与 `next.config.mjs` 中的 `basePath` 一致
2. `lib/source.ts` 中的 `baseUrl` 配置正确，避免路径重复
3. 所有内部链接都使用了正确的路径


## Slug 配置改造

本文档详细说明了如何在 Fumadocs 项目中使用 `slug` 字段实现固定链接功能，以及如何在 `meta.json` 中使用 slug 引用页面。

### 功能概述

#### 核心功能

1. **固定 URL 链接**：通过在 MDX 文件的 frontmatter 中设置 `slug` 字段，可以固定页面的 URL，即使文件重命名或移动文件夹，URL 也不会改变。

2. **meta.json 中的 slug 引用**：在 `meta.json` 中可以直接使用 slug 来引用页面，文件重命名后无需更新 `meta.json`。

#### 解决的问题

- ✅ 文件重命名后，URL 保持不变
- ✅ 文件夹移动后，URL 保持不变
- ✅ `meta.json` 中使用 slug 引用，无需随文件路径变化而更新
- ✅ 实现语义化的 URL 结构

---

### 实现原理

#### 技术实现

1. **扩展 Frontmatter Schema**（`source.config.ts`）
   - 添加可选的 `slug` 字段，支持字符串或字符串数组

2. **自定义 LoaderPlugin**（`lib/source.ts`）
   - 读取 frontmatter 中的 `slug` 字段
   - 建立 slug 到文件路径的映射
   - 处理 `meta.json` 中的 slug 引用，自动转换为文件路径

#### 工作流程

```
1. 读取所有 MDX 文件
   ↓
2. 提取 frontmatter 中的 slug 字段
   ↓
3. 建立 slug → 文件路径的映射
   ↓
4. 处理 meta.json，将 slug 引用替换为文件路径
   ↓
5. 生成最终的页面结构
```

---

### 使用方法

#### 1. 在 Frontmatter 中设置 Slug

在 MDX 文件的 frontmatter 中添加 `slug` 字段：

##### 方式 1：使用字符串（单个路径段）

```yaml
---
title: 我的文章
slug: my-article
---
```

生成的 URL：`/notes/my-article`

##### 方式 2：使用字符串（多个路径段，用斜杠分隔）

```yaml
---
title: 我的文章
slug: category/my-article
---
```

生成的 URL：`/notes/category/my-article`

##### 方式 3：使用数组（多个路径段）

```yaml
---
title: 我的文章
slug: ["category", "subcategory", "my-article"]
---
```

生成的 URL：`/notes/category/subcategory/my-article`

#### 2. 在 meta.json 中使用 Slug 引用

在 `meta.json` 的 `pages` 数组中，可以直接使用 slug 来引用页面：

```json
{
  "title": "随笔",
  "root": true,
  "pages": [
    "index",
    "my-article"  // 使用 slug，而不是文件路径
  ]
}
```

**注意**：系统会自动识别 `pages` 中的值是否为 slug：
- 如果匹配到 slug，自动转换为对应的文件路径
- 如果是文件路径，保持原样

---

### 配置说明

#### 1. source.config.ts

扩展了 frontmatter schema 以支持 `slug` 字段：

```typescript
import { z } from 'zod';

// 扩展 frontmatter schema 以支持可选的 slug 字段
const customFrontmatterSchema = frontmatterSchema.extend({
  slug: z.union([z.string(), z.array(z.string())]).optional(),
});

export const notes = defineDocs({
  dir: 'content/notes',
  docs: {
    schema: customFrontmatterSchema,
    // ...
  },
});
```

#### 2. lib/source.ts

实现了 `customSlugsPlugin` 插件：

```typescript
function customSlugsPlugin(): LoaderPlugin {
  // 建立 slug 到文件路径的映射
  const slugToFileMap = new Map<string, string>();
  const fullSlugToFileMap = new Map<string, string>();
  
  return {
    enforce: 'pre',
    transformStorage({ storage }) {
      // 处理页面，设置 slugs 并建立映射
      // 处理 meta.json，将 slug 引用替换为文件路径
    },
  };
}
```

---

### 使用示例

#### 示例 1：基本使用

**文件：`content/notes/essay/demo/index.mdx`**

```yaml
---
title: Demo 页面
description: 这是一个演示页面
slug: demo-page
---
```

**文件：`content/notes/essay/meta.json`**

```json
{
  "title": "随笔",
  "pages": [
    "index",
    "demo-page"  // 使用 slug
  ]
}
```

**结果**：
- URL：`/notes/demo-page`
- 即使将 `demo` 文件夹重命名为 `demo-v2`，URL 仍然保持不变

#### 示例 2：多级路径

**文件：`content/notes/essay/demo/index.mdx`**

```yaml
---
title: Demo 页面
slug: essay/demo-page
---
```

**结果**：
- URL：`/notes/essay/demo-page`
- 即使文件移动到其他位置，URL 仍然保持不变

#### 示例 3：在 meta.json 中使用完整路径

**文件：`content/notes/essay/meta.json`**

```json
{
  "title": "随笔",
  "pages": [
    "index",
    "essay/demo-page"  // 使用完整的 slug 路径
  ]
}
```

系统会自动找到对应的文件，即使文件路径发生变化。

---

### 优势说明

#### 1. 固定链接

- **问题**：文件重命名或移动后，URL 会改变，导致外部链接失效
- **解决**：使用 `slug` 字段，URL 固定不变
- **示例**：`slug: "my-article"` 始终对应 `/notes/my-article`

#### 2. 灵活的 URL 结构

- **问题**：文件路径决定了 URL 结构，不够灵活
- **解决**：可以通过 `slug` 自定义 URL 结构
- **示例**：文件在 `content/notes/old-folder/article/index.mdx`，但 URL 可以是 `/notes/new-url`

#### 3. meta.json 维护简化

- **问题**：文件重命名后，需要更新 `meta.json` 中的引用
- **解决**：使用 slug 引用，文件重命名后无需更新 `meta.json`
- **示例**：`meta.json` 中使用 `"my-article"`，即使文件路径改变，仍然有效

#### 4. 语义化 URL

- **问题**：文件路径可能不够语义化（如 `article-2024-01-01`）
- **解决**：使用 `slug` 创建更友好的 URL（如 `new-year-article`）

---

### 常见问题

#### Q1: 如果不设置 slug，会怎样？

**A**: 如果不设置 `slug`，Fumadocs 会使用默认的文件路径生成 URL。例如：
- 文件：`content/notes/essay/demo/index.mdx`
- URL：`/notes/essay/demo`

#### Q2: slug 和文件路径可以不一致吗？

**A**: 可以。`slug` 字段会覆盖默认的文件路径。例如：
- 文件：`content/notes/essay/demo/index.mdx`
- `slug: "my-custom-url"`
- URL：`/notes/my-custom-url`（而不是 `/notes/essay/demo`）

#### Q3: 在 meta.json 中，slug 和文件路径可以混用吗？

**A**: 可以。`meta.json` 中的 `pages` 数组可以同时包含：
- 文件路径：`"demo"`
- slug：`"demo-page"`（如果存在对应的 slug）

系统会自动识别并处理。

#### Q4: 如果多个文件使用相同的 slug 会怎样？

**A**: 后处理的文件会覆盖先处理的文件。建议确保每个 slug 唯一。

#### Q5: slug 支持哪些字符？

**A**: slug 支持 URL 安全的字符。建议使用：
- 小写字母：`a-z`
- 数字：`0-9`
- 连字符：`-`
- 下划线：`_`
- 斜杠：`/`（用于多级路径）

避免使用：
- 空格（使用连字符代替）
- 特殊字符（如 `@`, `#`, `$` 等）

#### Q6: 如何迁移现有内容到使用 slug？

**A**: 迁移步骤：

1. **为现有文件添加 slug**：
   ```yaml
   ---
   title: 现有文章
   slug: existing-article  # 使用当前 URL 的路径段
   ---
   ```

2. **更新 meta.json**（可选）：
   ```json
   {
     "pages": [
       "existing-article"  // 使用 slug 而不是文件路径
     ]
   }
   ```

3. **验证**：确保所有链接仍然正常工作

---

### 技术细节

#### Slug 映射机制

系统建立了两个映射表：

1. **slugToFileMap**：最后一段 slug → 文件路径
   - 用于快速匹配单个路径段
   - 例如：`"demo-page"` → `"essay/demo"`

2. **fullSlugToFileMap**：完整 slug 路径 → 文件路径
   - 用于精确匹配完整路径
   - 例如：`"essay/demo-page"` → `"essay/demo"`

#### meta.json 处理逻辑

1. 遍历 `meta.json` 中的 `pages` 数组
2. 对于每个条目：
   - 首先尝试完整路径匹配
   - 如果失败，尝试最后一段匹配
   - 如果找到匹配，转换为相对文件路径
   - 如果未找到，保持原样（作为文件路径处理）

#### 相对路径计算

系统会自动计算相对于 `meta.json` 所在目录的文件路径：

- `meta.json` 在 `essay/`，文件在 `essay/demo/` → 返回 `"demo"`
- `meta.json` 在 `essay/`，文件在 `essay/` → 返回 `"index"`

---

### 最佳实践

#### 1. 使用有意义的 slug

```yaml
# ✅ 推荐
slug: getting-started
slug: api-reference
slug: advanced-topics

# ❌ 不推荐
slug: page1
slug: doc-2024-01-01
slug: temp
```

#### 2. 保持 slug 简洁

```yaml
# ✅ 推荐
slug: quick-start

# ❌ 不推荐
slug: how-to-get-started-with-our-amazing-product-in-5-minutes
```

#### 3. 使用一致的命名风格

```yaml
# ✅ 推荐：使用连字符
slug: api-reference
slug: user-guide

# 或者使用下划线（保持一致）
slug: api_reference
slug: user_guide
```

#### 4. 在 meta.json 中优先使用 slug

```json
{
  "pages": [
    "index",
    "getting-started",  // ✅ 使用 slug
    "api-reference"     // ✅ 使用 slug
  ]
}
```

这样即使文件重命名，`meta.json` 也不需要更新。

---

### 相关文件

- `source.config.ts` - Frontmatter schema 配置
- `lib/source.ts` - LoaderPlugin 实现
- `content/notes/**/*.mdx` - MDX 内容文件
- `content/notes/**/meta.json` - 导航配置文件

---

### 参考资料

- [Fumadocs Source API](https://fumadocs.dev/docs/headless/source-api)
- [Fumadocs Loader Plugins](https://fumadocs.dev/docs/headless/source-api#loader-plugins)
- [Zod Schema](https://zod.dev/) - 用于 schema 验证